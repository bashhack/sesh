ğŸ› ï¸ sesh â€” Developer Technical Overview

ğŸ” Summary

sesh is a Go CLI tool that generates AWS session credentials using MFA via TOTP codes, stored securely in macOS Keychain. It shells out to the AWS CLI (aws sts get-session-token) and prints credentials as export statements for shell evaluation (eval "$(sesh)").

ğŸ’¡ Designed for security, simplicity, and zero runtime dependencies
ğŸ’» Works on macOS with native Keychain support; Linux support not yet implemented
ğŸ§™ Includes first-time wizard (--setup) to guide users through MFA provisioning and secret storage
ğŸ§± Project Structure

.
â”œâ”€â”€ cmd/sesh/main.go             # CLI entrypoint, flag parsing
â”œâ”€â”€ internal/aws/auth.go        # AWS CLI interactions: STS and MFA device listing
â”œâ”€â”€ internal/keychain/keychain.go # macOS Keychain integration
â”œâ”€â”€ internal/totp/totp.go       # TOTP code generation (pquerna/otp)
â”œâ”€â”€ internal/setup/setup.go     # Interactive first-time setup wizard
âš™ï¸ How it Works (Flow Summary)

CLI parses flags and env vars for AWS profile, keychain account/service, MFA serial.
If --setup is provided:
Walks user through creating a virtual MFA device in the AWS Console
Prompts for the Base32 MFA secret
Writes it into macOS Keychain with security add-generic-password
On normal execution:
Reads the secret from Keychain (security find-generic-password)
Generates current TOTP code
Calls aws sts get-session-token with the code
Parses the JSON response
Outputs AWS credential exports for use via eval "$(sesh)"
ğŸ“¦ Build/Release Pipeline

make build â†’ builds binary to ./sesh
make release â†’ runs GoReleaser (.goreleaser.yml)
Releasing tags (e.g. v1.0.0) generate multi-arch binaries and GitHub assets
ğŸ§ª Testing Considerations

No unit tests implemented yet (only stubbed auth_test.go)
Code is designed to shell out to aws and security â€” use interfaces or wrappers if unit test coverage is desired
Add test scaffolding to simulate keychain/AWS CLI output via mocks
ğŸ”§ Outstanding Technical Tasks


Area	Task	Status
ğŸ” Cross-platform support	Add GPG/Pass backend for Linux (as fallback to Keychain)	âŒ Not Started
ğŸ§ª Tests	Add unit tests for each internal package (aws, keychain, totp, setup)	ğŸš§ Needs Scaffolding
ğŸ’¬ UX polish	Gracefully handle shell failures, e.g. AWS CLI not installed, expired creds	ğŸš§ Basic
ğŸ—‚ Config structure	Optional: support config file ~/.config/sesh/config.json	âŒ Future
ğŸ§ª AWS detection	Auto-detect AWS CLI config profile list and warn if profile is unset	âŒ Not Started
ğŸ“„ Versioning	Add --version flag and semantic version tracking	âŒ Not Started
ğŸº Homebrew support	Add a brew tap formula and install path validation script	âŒ Not Started
ğŸ§ª CI/CD pipeline	Setup GitHub Actions workflow for build/test/release	âŒ Not Started
ğŸ” Security Notes

Keychain use is read-only after initial --setup; secrets are never written unprompted
MFA code is never printed or logged
All subprocess outputs are captured securely (stderr, exit codes checked)
No file-based secrets or credential persistence beyond environment exports
ğŸ§  Design Philosophy

â€œAs close to curl && go as possible.â€
No dependencies beyond the Go standard library + one small TOTP lib
No shell scripts, Python, or external CLI dependencies beyond aws
Every piece of setup and authentication logic resides in Go
Let me know if you'd like a CONTRIBUTING.md, GitHub Actions config, or test harness setup next.

IMPORTANT: Show visual feedback to user when running to give them insight into how long their MFA session is active for, etc.
